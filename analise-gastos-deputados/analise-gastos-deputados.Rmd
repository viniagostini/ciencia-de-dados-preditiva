---
title: "R Notebook"
output: html_notebook
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

```{r}
dadosCEAP = read_csv("./dadosCEAP.csv")
```

Para essa análise usaremos dados de gastos de deputados utilizando a cota para o exrcício da atividade parlamentar (CEAP), que é uma cota única mensal destinada a custear os gastos dos deputados exclusivamente vinculados ao exercício da atividade parlamentar. Mais informações [aqui](http://www2.camara.leg.br/transparencia/acesso-a-informacao/copy_of_perguntas-frequentes/cota-para-o-exercicio-da-atividade-parlamentar).

Ao longo da análise reponderemos 6 perguntas usando esses dados.


### Pergunta 1: Quais são os deputados que gastaram mais dinheiro da CEAP? Quais são os mais econômicos?
```{r}
p1Dados <- dadosCEAP %>% group_by(nomeParlamentar) %>% 
                        filter(valorLíquido > 0) %>% 
                        summarise(valorLíquido = sum(valorLíquido)) %>% 
                        arrange(desc(valorLíquido))

topDeputadosGastadores <- p1Dados %>% head(10)
topDeputadosEconomicos <- p1Dados %>% tail(10)


topDeputadosGastadores %>%
ggplot(aes(x=reorder(nomeParlamentar, -valorLíquido), y=valorLíquido, fill=factor(valorLíquido)))+
  geom_bar(stat="identity", position="dodge")+
  coord_flip() +
  scale_fill_discrete(name = "Valor Gasto") +  
  ylab("Valor líquido gasto da Cota Parlamentar (em R$)") +
  xlab("Nome do Parlamentar") + 
  ggtitle("Deputados que gastaram mais dinheiro da CEAP")
```

Agrupando os dados por nome de parlamentar, somando os gastos líquidos de cada um e ordenando os parlamentares por total gasto, temos um ranking de quem gastou mais, desse ranking, o gráfico acima exibe os 10 parlamentares que mais gastaram dinheiro da CEAP.

```{r}
topDeputadosEconomicos %>%
ggplot(aes(x=reorder(nomeParlamentar, -valorLíquido), y=valorLíquido, fill=factor(valorLíquido)))+
  geom_bar(stat="identity", position="dodge")+
  coord_flip() +
  scale_fill_discrete(name = "Valor Gasto") +  
  ylab("Valor líquido gasto da Cota Parlamentar (em R$)") +
  xlab("Nome do Parlamentar") + 
  ggtitle("Deputados que gastaram menos dinheiro da CEAP")
```

De maneira análoga aos que mais gastaram dinheiro da CEAP, selecionamos os 10 parlamentares que menos gastaram.  


### Pergunta 2: Quais os estados cujos deputados gastam mais no exterior? Quais os estados cujos deputados gastam menos no exterior?

```{r}
dadosGastosExterior <- dadosCEAP %>% filter(tipoDocumento == 2)

gastosExteriorPorParlamentar <- dadosGastosExterior %>% 
                                group_by(nomeParlamentar, idCadastro) %>% 
                                filter(valorLíquido > 0) %>% 
                                summarise(valorLíquido = sum(valorLíquido), sgUF = first(sgUF))

#está excluindo alguns estado. Não entendo porque.
medianaDeGastoDeParlamentaresPorEstado <- gastosExteriorPorParlamentar %>% 
                                          group_by(sgUF) %>% 
                                          summarise(medianaValorLiquido = median(valorLíquido)) %>% arrange(desc(medianaValorLiquido))

medianaDeGastoDeParlamentaresPorEstado %>%
ggplot(aes(x=reorder(sgUF, -medianaValorLiquido), y=medianaValorLiquido, fill=factor(medianaValorLiquido)))+
  geom_bar(stat="identity", position="dodge")+
  coord_flip() +
  scale_fill_discrete(name = "Valor Gasto") +  
  ylab("Mediana dos gastos de parlamentares no exterior (em R$)") +
  xlab("Estado") + 
  ggtitle("Mediana de gastos de parlamentares no exterior por estado")
```

Para responder a essa pergunta, coletamos todos dos dados de gastos no exterior, agrupamos os gastos por parlamentar, ficando assim com os gastos de cada parlamentar no exterior, após isso, agrupamos esses dados por estado, calculando a mediana dos gastos de parlamentares no exterior por estado.  
Ficamos assim com a mediana dos gastos de parlamentares no exterior por estado, essa é a informação exibida no gráfico acima, onde podemos ver todos os estados na ordem de quem gasta menos para quem gasta mais.

### Pergunta 3: Quais os partidos cujos parlamentares mais usam CEAP no estado da Paraíba? Quais são os que menos usam?

```{r}
dadosDeGastosParaiba <- dadosCEAP %>% filter(sgUF == "PB")

gastosParlamentaresPB <- dadosDeGastosParaiba %>% group_by(nomeParlamentar) %>% 
                        filter(valorLíquido > 0) %>% 
                        summarise(valorLíquido = sum(valorLíquido), sgPartido = first(sgPartido))

medianaDeGastoDeParlamentaresPBPorPartido <- gastosParlamentaresPB %>% 
                                          group_by(sgPartido) %>% 
                                          summarise(medianaValorLiquido = median(valorLíquido)) %>% arrange(desc(medianaValorLiquido))

medianaDeGastoDeParlamentaresPBPorPartido %>%
ggplot(aes(x=reorder(sgPartido, -medianaValorLiquido), y=medianaValorLiquido, fill=factor(medianaValorLiquido)))+
  geom_bar(stat="identity", position="dodge")+
  coord_flip() +
  scale_fill_discrete(name = "Valor Gasto") +  
  ylab("Mediana dos gastos de parlamentares (em R$)") +
  xlab("Partido") + 
  ggtitle("Mediana de gastos de parlamentares por partido na Paraíba")
```

Aqui, coletamos todos os gastos de parlamentares da Paraíba, agrupamos os dados por parlamentar somando os gasto líquidos. Depois, agrupamos os parlmamentares por partidos, pegando a mediana de gastos de parlamentares. Assim, ficamos com a mediana de gastos de parlamentares por partidos na Paraíba.  
Exibimos essa informação no gráfico acima na ordem de partidos que menos gastam aos que mais gastam.


